---
title: "第十一回: 同じ事のいろいろな書き方"
layout: page
---

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.35.0/codemirror.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.35.0/codemirror.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.35.0/mode/javascript/javascript.js"></script>
<style>
    .CodeMirror { height: auto; border: 1px solid #ddd; }
    .console { border: 1px solid #333; color: rgb(48, 68, 216); padding: 0px 5px 0px 5px; }

    .answer {color: red;  }
    .hideanswer { display: none; }
    .result {font-size: large;}
    .wrong {color: red;  }
    .correct {color: rgb(0, 89, 255);  }



    .column{
        padding: 0.5em 1em;
        margin: 2em 0;
        color: #5d627b;
        background: white;
        border-top: solid 5px #5d627b;
        box-shadow: 0 3px 5px rgba(0, 0, 0, 0.22);
    }    
</style>
<link rel="stylesheet" href="https://rawgit.com/karino2/js-introduction/master/scripts/smoke.css" />
<script src="https://rawgit.com/karino2/js-introduction/master/scripts/smoke.min.js"></script>                    
<script src="https://neil.fraser.name/software/JS-Interpreter/acorn_interpreter.js"></script>

<script type="text/javascript" src="https://rawgit.com/karino2/js-introduction/master/scripts/env.js"></script>



<script>
var questions = [];


document.body.onload = function() {
  initInterpreter();


  setupAllREPL2(1);
  setupAllQuestionsWithScnario(questions);
}
</script>


JavaScriptは、いろいろな事情から同じ事を複数の書き方で書ける言語です。
自分が書く時は一通りのやり方だけ知っていれば十分ですし、
実際同じやり方で統一されている方が良いコードでもあります。

ですが、他人のコードを読む時には、他人の書き方を知っている必要があります。
また、JavaScriptの入門書や入門サイトを見る時も、それらで使われている書き方を知っている方が話は早い。

そこで第十一回は、これまでやった事と同じ事を別の書き方でやる、という回になります。

細かい理屈とか「何故？」とか考えるよりも、「ここまでやってきたこの書き方と同じ意味なのか」とこれまでの内容に対応づける事を意識して読んでください。

なお、ここまでやってきた書き方はだいたいツクールMVのプラグインで良く使われる書き方にそって解説しているつもりです。
そういう点では以下の書き方はツクールMVのプラグインではあまり出てこないので、
たまに出てきた時に昔どっかで見たな、とここを思い出して見直すくらいでOKのはずです。

### 関数の作り方

これまで、以下のような関数の作り方を見てきました。

```
var awa = function() {
    MessageBox.show("むぇー");
};
```

JavaScriptでは、これと全く同じ事を以下のようにも書けます。

```
function awa() {
    MessageBox.show("むぇー");
};
```

`function`の後に関数を入れる変数名を書く、という事が出来るのです。
なんで？という理由は無く、そういうものなのです。

これでvarをつけた時のように、変数としての箱も出来ます。

### 関数の文字や数字の受け取り方

お嬢様はセバスチャンに何かを言いつける時に、`arguments`というのを使う事で数字や文字を渡せる、という話をしました。


```
var awa = function() {
    // 受け取る
    MessageBox.show(arguments[0]);
};

// 渡す
awa("ごあーん");
```

これの関数を作る所は、以下のように間に変数を使っても同じ意味になりますね。

```
var awa = function() {
    // 一旦変数に受け取る
    var nakigoe = arguments[0];

    MessageBox.show(nakigoe);
};
```

これと同じ事を、以下のように書けます。

```
var awa = function(nakigoe) {

    MessageBox.show(nakigoe);
};
```

つまり、`function(nakigoe)`のように、functionのあとのカッコの中に変数の名前を書いておくと、その変数でarguments[0]を受け取ったかのように振る舞います。

なお、複数何かを渡す場合、例えば以下みたいな場合は、

```
var lucy = function() {
    // 3つ受け取る
    var kochinkochin_ni = arguments[0];
    var hieta = arguments[1];
    var mugicya = arguments[2];

    MessageBox.show(kochinkochin_ni);
    MessageBox.show(hieta);
    MessageBox.show(mujgicya);
};


// 3つ渡す
lucy("こちんこちんに", "ひえた", "麦茶！");
```

こう書く事も出来ます。

```
var lucy = function(kochinkochin_ni, hieta, mugicya) {
    MessageBox.show(kochinkochin_ni);
    MessageBox.show(hieta);
    MessageBox.show(mujgicya);
};


// 3つ渡す
lucy("こちんこちんに", "ひえた", "麦茶！");
```

このように、`function(kochinkochin_ni, hieta, mugicya)`みたいに書くと、関数の先頭で
以下のように書いたのと

```
    var kochinkochin_ni = arguments[0];
    var hieta = arguments[1];
    var mugicya = arguments[2];
```

同じ意味になるんですね。
わけわからん、と思うかもしれませんが、上みたいな書き方が出てきたら下の事だ、と翻訳して読むのです。

幸い、プラグインはいろいろな事情により`arguments`を使う事の方が多いのであまりここの書き方は出てこないと思います。
どちらかというとwebとか入門書で良く出てくる書き方ですね。

なお、覚えなくて良いですが、この`function(nakigoe)`とかのように`function`の後のカッコの中に書いた変数を、「仮引数」と呼びます。「かりひきすう」って読みます。ひきすうってなんやねん。
C言語とかJavaには`arguments`が無いので、こういう用語があるのですが、我々は気にする必要はありません。

さらに覚えなくて良いですが、こういう風に同じ事を短く書けるヘンテコなルールを、「シンタックスシュガー」と呼びます。
長渕を怒らせない方針の我々は、横文字は使いません。


### 2つのやり方を合わせる

先に説明した2つの書き方は、両方同時に使う事が出来ます。
つまり、以下のようなコードは、


```
var awa = function() {
    MessageBox.show(arguments[0]);
};
```

こう書いても同じ意味になります。

```
function awa(nakigoe) {
    MessageBox.show(nakigoe);
};
```

ツクールのプラグインではあまり見る事は無いこの書き方ですが、
それ以外の分野では良く使われます。

webの入門書などではこの書き方をしている事が多いと思いますし、
またUnityScriptやSecond Lifeのスクリプトなど、
JavaScriptに似せた独自の言語はこの書き方を採用する事が多い気がします。

現時点では慣れる必要はありませんが、ある程度ツクールMVなどで経験を積んだ後にこの辺に軽く慣れておくと、
よそのプログラミング言語を覚える時などには便利です。
たださすがにそんなのはその時やればいいと思うので、
このJavaScript入門シリーズでは課題とかはやりません。

### TODO: 無名関数の式がサポートされてたか調査






## 関数を作ってすぐ実行する

関数は以下のようなコードで作って使える訳ですが、

```
// 関数を作って
var awa = function() {
    MessageBox.show("むぇー");
};

// 関数を使う
awa();
```

これを両方同時にやる事が出来ます。以下のように書きます。

```
(function() {
    MessageBox.show("むぇー");
})();
```

なんじゃこりゃ、って感じですね。最初のカッコをawaという変数に置き換えると、最後のカッコが関数を使う時のカッコである事が分かるのですが、あんまり細かい理屈を気にする必要はありません。

それよりは、`(function() {`で始めて、`})();`で終わると、間の所がその場で実行される、という風に覚えてしまう方が良い。
こういう、ごちゃっとした書き方で良くあるパターンをイディオムといいますが、
長渕準拠の我々はそんな言葉は使いません。

### なんでこんな事するのか？（ここは分からなくて良いです）

さて、この関数を作ってすぐ実行する、というテクニックは、
良く意味が分からない所があります。

中に書いた事がその場で実行されるのだから、こんなテクニック使わずに書いたのと同じ結果になる訳です。
つまり、

```
(function() {
    MessageBox.show("むぇー");
})();
```

と

```
    MessageBox.show("むぇー");
```

は、全く同じ結果になります。

では何故こんな事をするか、というと、変数がぶつからないようにする為です。

偶然プラグインAが作った変数awaに、プラグインBが別の目的でawaという変数を作ると、
この変数が上書きされてしまってプラグインAが壊れてしまう、という問題があります。

ですが、JavaScriptでは、関数の中の変数と外の変数は別の物、と扱われるという性質があります。
例えば以下のようなコードを実行してみましょう。

```
// 外のnakigoe
var nakigoe = "むぇー";

var daniki = function(){
    // 関数の中のnakigoe
    var nakikgoe = "ダネー";

    // この行のnakigoeは関数の中のnakigoe
    MessageBox.show(nakigoe);
}

// ここは関数の外なので、外のnakigoeが使われる
MessageBox.show(nakigoe);

// 関数を使う。この中では関数の中のnakigoeが作られて使われる
daniki();

// 上の行で関数の中のnakigoeが作られたが、外のnakigoeには影響が無い
MessageBox.show(nakigoe);
```

このように、関数の中の変数は関数の外の変数には影響を与えません。

このトリックを使う事で、ある範囲の外には影響を与えずに変数が使える、というのが、先程紹介したテクニックの目的になります。

例えば以下のようになります。

```
// 外のnakigoe
var nakigoe = "むぇー";

(function(){
    // 関数の中のnakigoe
    var nakikgoe = "ダネー";

    // この行のnakigoeは関数の中のnakigoe
    MessageBox.show(nakigoe);
})();

// 関数の中のnakigoeは、外のnakigoeには影響を与えない
MessageBox.show(nakigoe);
```

そういう訳で、理屈はおいといて、`(function(){`で始めて、最後に`})();`と書いておくと、間違って同じ名前の変数を作っちゃう、という事を避ける事が出来ます。


**この話は見た目ほど簡単じゃない**

なんか難しそうな事言ってるがどうって事無い、と思うかもしれませんが、これはいろいろ変な事が起こるのです。
例えば、daniki関数の先頭でvarをつけ忘れると結果が変わります。


```
var nakigoe = "むぇー";

var daniki = function(){
    // ここにvarをつけ忘れて他のコードは全部一緒
    nakikgoe = "ダネー";

    MessageBox.show(nakigoe);
}

MessageBox.show(nakigoe);

daniki();

// ここでは、何故か"ダネー"になっちゃってる
MessageBox.show(nakigoe);
```

これはJavaScriptには、変数を作らずに使うと、外の変数だと思う性質があるからです。
これはさらにvarがブロックスコープじゃないせいでもっと変な例がいろいろと作れて、
中級者にも意味が分からないような例も作れてしまう事が知られています。

あまりにも意味不明なので、次のJavaScriptのバージョンではvarを使うのは禁止にして、
もっと分かりやすく振る舞うletという物にしよう、という事が決まっているくらいです。
実際ツクールMVでもletを使う事は出来るようですが、皆使っていないようなので、
本シリーズでは解説しません。

今はこのvarとletのちょうど過渡期で、もう二年くらいすればたぶんみんなletになりそうです。
という事で、この辺の事を今頑張って理解する必要は無いと思うので、このシリーズではあまり真面目に解説してません。

この関数の中と外の変数がぶつからない現象は`スコープ`と言われています。

そしてこの関数を作ってすぐ実行する事でスコープを作るトリックを、IIFE（Immediately-Invoked Function Expression）と呼びます。
知らなくていいです。

### IIFEで知っておいて欲しい事

知っておいて欲しい事としては、

1. 複数のプラグインでたまたま同じ名前の変数を作ろうとするとぶつかる事がある
2. ぶつかったらどっちかの名前を変えればいいだけだし、現実的にはほとんどぶつかる事は無い
3. 現実的にはほとんどぶつからない事だけど、神経質な人たちは変なトリックでぶつからないようにしている
   - 読む時はそんなトリック無視して読んでOK（だいたいぶつからないから！）

という位です。





<div id="ex1">
<input type="button" value="実行" />
<textarea>
var naku = function() {
   MessageBox.show("むぇーー");
};

naku();</textarea>
<b>結果:</b> <span class="console"></span><br>
</div>
  
　  


**コラム**  
ひとつめ。  
　  
二つ目。
{: .column}
