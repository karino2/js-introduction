---
title: "第十二回: 簡単なプラグインのコードを読んでみよう"
layout: page
---

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.35.0/codemirror.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.35.0/codemirror.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.35.0/mode/javascript/javascript.js"></script>
<style>
    .CodeMirror { height: auto; border: 1px solid #ddd; }
    .console { border: 1px solid #333; color: rgb(48, 68, 216); padding: 0px 5px 0px 5px; }

    .answer {color: red;  }
    .hideanswer { display: none; }
    .result {font-size: large;}
    .wrong {color: red;  }
    .correct {color: rgb(0, 89, 255);  }



    .column{
        padding: 0.5em 1em;
        margin: 2em 0;
        color: #5d627b;
        background: white;
        border-top: solid 5px #5d627b;
        box-shadow: 0 3px 5px rgba(0, 0, 0, 0.22);
    }    
</style>
<link rel="stylesheet" href="https://rawgit.com/karino2/js-introduction/master/scripts/smoke.css" />
<script src="https://rawgit.com/karino2/js-introduction/master/scripts/smoke.min.js"></script>                    
<script src="https://neil.fraser.name/software/JS-Interpreter/acorn_interpreter.js"></script>

<script type="text/javascript" src="https://rawgit.com/karino2/js-introduction/master/scripts/env.js"></script>



<script>
var questions = [];


document.body.onload = function() {
  initInterpreter();


  // setupAllREPL2(1);
  setupAllQuestionsWithScnario(questions);
}
</script>

（たぶん）最終回です。

第十二回は、おまけとして、実際のツクールMVのプラグインのうち簡単そうな奴を読んで行こう、という回になります。

前回まではツクールMVと関係無い一般的なJavaScriptの話でしたが、今回だけはツクールMV特有の話です。

自分はツクールMVは素人なのですが、プログラムを読むヒントくらいは伝えられるかな、と思います。


実際のコードには説明して無い事や良く分からない複雑な部分などが出てくるものです。


# 一番簡単なプラグイン

自分はツクールMVは素人なので、「ツクールMV プラグイン 入門」とかで適当にググって当たったサイトから簡単そうなのを選んでみます。

自分がちらっと見た範囲だと一番簡単なのはこちらのサイトでした。[プラグイン開発Wiki - RPGツクールMV](https://www65.atwiki.jp/rpgmvpl/pages/12.html)


### まずはコードから

今回はプラグインの仕組みとかそういう話はあまりせずに、コードの方だけ見ていきます。
パラメータとかその辺の事は入門サイトで勉強してください。

さて、コードを転載すると以下のようでした。

```
(function(){
	var _Game_Interpreter_pluginCommand =
		Game_Interpreter.prototype.pluginCommand;

	Game_Interpreter.prototype.pluginCommand = function(command, args)
	{
		_Game_Interpreter_pluginCommand.call(this, command, args);

		if( command === 'test_pl' )
			$gameMessage.add( "プラグインが呼び出されたよ☆" );
	};
})();
```

この一行目と最後の行は、[前回](ch11.md)やった、関数を作ってすぐ実行する、という奴でした。
この中の変数が他とぶつからない為のトリックなのですが、動作を知りたいだけならあまり気にしなくて良い。

取り除くとこうなります。

```
	var _Game_Interpreter_pluginCommand =
		Game_Interpreter.prototype.pluginCommand;

	Game_Interpreter.prototype.pluginCommand = function(command, args)
	{
		_Game_Interpreter_pluginCommand.call(this, command, args);

		if( command === 'test_pl' )
			$gameMessage.add( "プラグインが呼び出されたよ☆" );
	};
```

ちょっとvarで用意している変数の名前が長いので、少し短くしましょう。
これはもともとの関数なのでmotomotoという名前にします（後で何がもともとなのかは説明します）。


```
	var motomoto =
		Game_Interpreter.prototype.pluginCommand;

	Game_Interpreter.prototype.pluginCommand = function(command, args)
	{
		motomoto.call(this, command, args);

		if( command === 'test_pl' )
			$gameMessage.add( "プラグインが呼び出されたよ☆" );
	};
```

さて、順番に見ていきましょう。

### まず元の関数を変数に入れる

最初の二行をまず見てみます。

```
	var motomoto =
		Game_Interpreter.prototype.pluginCommand;
```

`Game_Inpterpreter`というのはツクールMVが用意してくれている辞書で、
その中のprototypeも辞書です。
prototypeは少し特殊で詳細は解説しませんが、その前の辞書名と合わせて全体で辞書の名前だと思っておくと9割はOK。

つまりこの場合、`Game_Interpreter.prototype`全部でツクールMVが提供している辞書だと思っておきましょう。

この`なんちゃら.prototype`という辞書には、関数をいろいろ入れる決まりになっています。
という事で入っているのはだいたい関数です。

ここでは、この`なんちゃら.prototype`という辞書の中の`pluginCommand`というのを取り出しています。
これが辞書のキーな訳ですね。辞書のキーは[第六回](ch06.md)を参考にしてください。

こうして、`なんちゃら.prototype`という辞書の中の`pluginComamnd`という関数を取り出して`motomoto`という変数に入れた事になります。

### 関数を差し替えている所のコードを見る

続きのコードを見てみましょう。以下のようになっています。

```
	Game_Interpreter.prototype.pluginCommand = function(command, args)
	{
		motomoto.call(this, command, args);

		if( command === 'test_pl' )
			$gameMessage.add( "プラグインが呼び出されたよ☆" );
	};

```

ちょっと構造に注目する為、functionの中を...で置き換えてしまいましょう。

```
	Game_Interpreter.prototype.pluginCommand = function(command, args)
	{
        ...
	};

```

こうすると、先ほどの`なんちゃら.prototype`という辞書に、pluginCommandというキーで新しい関数を入れている事が分かります。

